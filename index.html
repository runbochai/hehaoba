<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>我想跟你好 (๑>◡<๑)</title>
    <style>
        /* Color variables */
        :root {
            --primary-pink: #ffb6c1;
            --dark-pink: #ff69b4;
            --bg-color: #fff0f5;
        }

        /* Main layout & Mobile safe-area fixes */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height */
            box-sizing: border-box;
            padding-bottom: env(safe-area-inset-bottom); /* iPhone X+ bottom padding */
            width: 100vw;
            background-color: var(--bg-color);
            font-family: 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            position: fixed;
            touch-action: none;
            perspective: 1000px;
        }

        /* Title text styling */
        #text-box {
            font-size: 2.5rem;
            color: #ff8da1;
            margin-bottom: 20px;
            font-weight: 900;
            z-index: 10;
            filter: drop-shadow(0 0 5px rgba(255, 141, 161, 0.5));
            user-select: none;
            text-align: center;
            padding: 0 20px;
        }

        /* Main image styling */
        .main-image {
            width: 250px;
            height: 250px;
            border-radius: 20px;
            border: 6px solid #fff0f5;
            box-shadow: 0 10px 20px rgba(255, 182, 193, 0.4);
            object-fit: cover;
            margin-bottom: 30px;
            z-index: 10;
            pointer-events: none;
            user-select: none;
            transition: all 0.2s ease;
        }

        /* Button container */
        .button-group {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 100%;
            height: 80px;
            z-index: 10;
        }

        /* Shared button styles */
        button {
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            white-space: nowrap;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* "Yes" button specific styles */
        #yes-btn {
            background-color: #98fb98;
            color: #2e8b57;
            box-shadow: 0 4px 0 #7ccd7c;
            z-index: 11;
        }

        /* "No" button specific styles */
        #no-btn {
            background-color: #ff4d4d;
            color: white;
            box-shadow: 0 4px 0 #cc0000;
            width: 150px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 12;
            will-change: transform; /* GPU Optimization */
        }

        /* Success screen overlay */
        #success-layer {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            height: 100dvh;
            padding-bottom: env(safe-area-inset-bottom);
            box-sizing: border-box;
        }

        /* Confetti particle styles */
        .confetti {
            position: fixed;
            top: -20px;
            background-color: #ff69b4;
            z-index: 200;
            opacity: 0;
            animation-timing-function: ease-in;
            animation-fill-mode: forwards;
        }

        @keyframes fallStatic {
            0% { transform: translateY(0); opacity: 1; }
            75% { transform: translateY(92vh); opacity: 1; }
            100% { transform: translateY(92vh); opacity: 0; }
        }

        @keyframes fall2d {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            75% { transform: translateY(92vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(92vh) rotate(120deg); opacity: 0; }
        }

        @keyframes fall3d {
            0% { transform: translateY(0) rotate3d(1, 1, 1, 0deg); opacity: 1; }
            75% { transform: translateY(92vh) rotate3d(1, 1, 1, 0deg); opacity: 1; }
            100% { transform: translateY(92vh) rotate3d(1, 1, 1, 140deg); opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="text-box">我想跟你好！</div>

    <img id="main-image" class="main-image" src="" alt="初始图">

    <div class="button-group">
        <button id="yes-btn">和好吧!</button>
        <button id="no-btn">不可以!</button>
    </div>

    <div id="success-layer">
        <h1 style="font-size: 2.5rem; color: #ff8da1; filter: drop-shadow(0 0 5px rgba(255, 141, 161, 0.5)); font-weight: 900;">好耶！ (๑>◡<๑)</h1>
        <p style="font-size: 1.5rem; color: #ff8da1; font-weight: bold;">请你吃蛋糕！</p>
        <img id="success-image" class="main-image" src="" alt="成功图">
        <button onclick="location.reload()" style="margin-top: 20px; background: white; color: pink; border: 1px solid pink;">重新选！</button>
    </div>

    <script>
        const noBtn = document.getElementById('no-btn');
        const yesBtn = document.getElementById('yes-btn');
        const mainImage = document.getElementById('main-image');
        const successLayer = document.getElementById('success-layer');
        const successImage = document.getElementById('success-image');

        const haoImages = ['pics/hao1.png', 'pics/hao2.png', 'pics/hao3.png', 'pics/hao4.png', 'pics/hao5.png'];
        const sadImages = ['pics/sad1.png', 'pics/sad2.png', 'pics/sad3.png', 'pics/sad4.png', 'pics/sad5.png'];
        const yesImages = ['pics/yes1.png', 'pics/yes2.png', 'pics/yes3.png'];

        // Variables to track current state (prevents repetition)
        let currentSadIdx = -1;
        let currentHaoIdx = -1; // Only used if we added session logic, but good for structure
        let yesSize = 1;

        // --- Helper Function: Get random index excluding current ---
        // This ensures the new picture is never the same as the old one
        function getRandomIndex(arrayLength, currentIndex) {
            if (arrayLength <= 1) return 0; // Safety check
            let newIdx;
            do {
                newIdx = Math.floor(Math.random() * arrayLength);
            } while (newIdx === currentIndex);
            return newIdx;
        }

        // Set start image
        function setRandomStartImage() {
            // Since this runs on reload, it's always random. 
            // Note: To prevent reload repetition requires SessionStorage, keeping it simple for now.
            const randomIdx = Math.floor(Math.random() * haoImages.length);
            mainImage.src = haoImages[randomIdx];
        }
        setRandomStartImage();

        // Escape Logic
        function escape() {
            if (noBtn.style.position !== 'fixed') {
                const rect = noBtn.getBoundingClientRect();
                noBtn.style.left = rect.left + 'px';
                noBtn.style.top = rect.top + 'px';
                noBtn.style.position = 'fixed';
                noBtn.style.transform = 'translate3d(0, 0, 0)';
                void noBtn.offsetWidth; 
                noBtn.style.transition = "transform 0.1s ease"; 
            }

            const padding = 20; 
            const maxX = window.innerWidth - noBtn.offsetWidth - padding;
            const maxY = window.innerHeight - noBtn.offsetHeight - padding;
            const randomX = Math.max(padding, Math.random() * maxX);
            const randomY = Math.max(padding, Math.random() * maxY);

            const currentLeft = parseFloat(noBtn.style.left);
            const currentTop = parseFloat(noBtn.style.top);
            const deltaX = randomX - currentLeft;
            const deltaY = randomY - currentTop;
            
            noBtn.style.transform = `translate3d(${deltaX}px, ${deltaY}px, 0)`;

            // --- Update Image (No Repeats) ---
            currentSadIdx = getRandomIndex(sadImages.length, currentSadIdx);
            mainImage.src = sadImages[currentSadIdx];

            const taunts = ["你说啥！？", "才不要...", "滚！", "还是算了吧...", "就不！", "就不跟你好！", "打咩!", "滚粗！", "想得美！"];
            noBtn.innerText = taunts[Math.floor(Math.random() * taunts.length)];

            yesSize += 0.15; 
            yesBtn.style.transform = `scale(${yesSize})`;
        }

        noBtn.addEventListener('mouseover', escape);
        noBtn.addEventListener('touchstart', (e) => {
            e.preventDefault(); 
            escape();
        });
        noBtn.addEventListener('click', (e) => {
            e.preventDefault();
            escape();
        });

        // Confetti Logic
        function spawnConfetti() {
            const colors = ['#ff69b4', '#ffb6c1', '#ffd700', '#ffffff', '#ff8da1', '#ffc0cb'];
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDuration = Math.random() * 2 + 3 + 's';
            
            const size = Math.random() * 10 + 6 + 'px';
            confetti.style.width = size;
            confetti.style.height = size;
            
            const rand = Math.random(); 
            if (rand < 0.20) {
                confetti.style.animationName = "fall3d";
                confetti.style.zIndex = "202";
            } else if (rand < 0.40) { 
                confetti.style.animationName = "fall2d";
                confetti.style.zIndex = "201";
            } else {
                confetti.style.animationName = "fallStatic";
            }
            
            document.body.appendChild(confetti);

            setTimeout(() => {
                confetti.remove();
            }, 6000);
        }

        function startCelebration() {
            const interval = setInterval(spawnConfetti, 40);
            setTimeout(() => {
                clearInterval(interval);
            }, 3000);
        }

        // Yes Button Logic
        yesBtn.addEventListener('click', () => {
            // Randomly select Yes image
            const randomYesIdx = Math.floor(Math.random() * yesImages.length);
            successImage.src = yesImages[randomYesIdx];
            successLayer.style.display = 'flex';
            startCelebration();
        });
    </script>
</body>
</html>
